@model Model.DTO_Model.DTO_Product_Item_Type

@{
    ViewBag.Title = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using Model.DTO_Model;


@{
    List<DTO_Product_Item_Type> cart = (List<DTO_Product_Item_Type>)Session["cart"];
    var total = cart.Sum(item => item.Quantity * item.Price);
    var total1 = cart.Count();
    var discount = 0;
    var totalShow = 0;


}
<style>
    input {
        border: 5px solid white;
        -webkit-box-shadow: inset 0 0 8px rgba(0,0,0,0.1), 0 0 16px rgba(0,0,0,0.1);
        -moz-box-shadow: inset 0 0 8px rgba(0,0,0,0.1), 0 0 16px rgba(0,0,0,0.1);
        box-shadow: inset 0 0 8px rgba(0,0,0,0.1), 0 0 16px rgba(0,0,0,0.1);
        padding: 15px;
        background: rgba(255,255,255,0.5);
        margin: 0 0 10px 0;
    }
</style>
<div class="breadcrumb-wrap">
    <div class="container-fluid">
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="~/Home/Index">Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="~/Product/Index">Danh sách sản phẩm</a></li>
            <li class="breadcrumb-item active">Thanh toán hóa đơn</li>
        </ul>
    </div>
</div>
<div class="checkout">
    <div class="container-fluid">
        @using (Html.BeginForm("saveOrder1", "Cart", FormMethod.Post))
        {
            <div class="row">
                <div class="col-lg-8">
                    <div class="checkout-inner">
                        <div class="billing-address">
                            <h2>Thanh toán hóa đơn </h2>
                            <div class="row">

                                <div class="col-md-6">

                                    <input class="form-control" type="text" value="" placeholder="Nhập tên" name="FirstName" required oninvalid="this.setCustomValidity('Vui lòng nhập tên')" oninput="this.setCustomValidity('')">
                                </div>
                                <div class="col-md-6">

                                    <input class="form-control" type="text" placeholder="Nhập Họ" name="LastName" required oninvalid="this.setCustomValidity('Vui lòng nhập họ')" oninput="this.setCustomValidity('')">
                                </div>
                                <div class="col-md-6">

                                    <input class="form-control" type="email" placeholder="Nhập Email" name="Email" required oninvalid="this.setCustomValidity('Vui lòng nhập địa chỉ email')" oninput="this.setCustomValidity('')">
                                </div>
                                <div class="col-md-6">

                                    <input class="form-control" type="tel" placeholder="Nhập số điện thoại" name="sdt" required oninvalid="this.setCustomValidity('Vui lòng nhập số điện thoại')" oninput="this.setCustomValidity('')">
                                </div>
                                <div class="col-md-12">

                                    <input class="form-control" type="text" placeholder="Nhập địa chỉ" name="diaChi" required oninvalid="this.setCustomValidity('Vui lòng nhập địa chi')" oninput="this.setCustomValidity('')">
                                </div>
                                <div class="col-md-6">
                                    <label>Tỉnh/Thành phố</label>
                                    <select class="custom-select" name="City">
                                        <option selected>Hà Nội</option>
                                        <option>Hồ Chí Minh</option>
                                        <option>Đà Nẵng</option>
                                        <option>Huế</option>
                                        <option>Đăk Lăk</option>
                                        <option>Nghệ An</option>
                                        <option>Hà Tĩnh</option>
                                        <option>Khánh Hóa</option>
                                        <option>Phú Yên</option>
                                        <option>Quảng Ngãi</option>
                                        <option>An Giang</option>
                                        <option>Tiền Giang</option>
                                        <option>Long An</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <input class="form-control" type="text" placeholder="ZIP Code" onchange="DiscountPrice()" name="zip" id="pricecode">
                                </div>

                            </div>
                            <br />
                            <input type="submit" class="btn btn-success" value="Hoàn thành">

                        </div>

                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="checkout-inner">
                        <div class="checkout-summary">
                            @*<p style="font-style:italic">Tổng số lượng sản phẩm mua<span>@total1</span></p>
                                <h2>Tổng tiền thanh toán
                                <br />
                                <span style="color:red">@total VNĐ</span></h2>
                                <p class="ship-cost">Giảm giá<span>VNĐ</span></p>*@
                            <div class="cart-content">

                                <p id="totalBefore" style="color:red">
                                    Thanh Toán : <span>

                                        @string.Format("{0:0,0}", total)
                                        VNĐ
                                    </span>
                                </p>

                                <p id="totalAfter" style="color:red; display:none" >
                                    Tổng thanh toán : <span> </span>
                                    <span>

                                        <input readonly id="gia1"  name="gia1" type="reset" value=" @string.Format("{0:0,0}", total)
                                        VNĐ" />
                                    </span>
                                </p>

                                @*<p>
                                    <input type="text" readonly style=" opacity:0.5; width:45px; height:30px" id="discount" name="discount1" />
                                    <br />

                                    <span style="font-style:italic">"the value for number is: " @discount</span>
                                </p>*@


                            </div>
                        </div>
                    </div>
                </div>

            </div>
        }
    </div>
    <div class="col-md-6">
        <p style="color:red;font-style:italic" id="message1">@ViewData["Message"]</p>
    </div>
</div>
<script>
    function Discount() {

        var dis = $('#discount').val();
        console.log("Discount is: " + dis);
        console.log("Total is: " + @total);
        var total_discount = @total -(@total* dis);
        console.log("Total discount is: " + total_discount);

        $('#gia').val(@total -(@total* dis));

    };

    function DiscountPrice() {
        var priceCode = $('#pricecode').val();
        console.log(priceCode);
        $.ajax({
            url: '/Cart/saveOrder2',
            data: { priceCode: priceCode },
            dataType: 'json',
            async: false,
            type: 'POST',
            success: function (res) {
                console.log();
                $("#discount").val(res.checkout * 100)

                var dis = res.checkout;
                let dollarUSLocale = Intl.NumberFormat('en-US');
                $('#gia1').val(dollarUSLocale.format(@total - (@total* dis)));

                var myJsVariable = '@total1';
                var message =  @Html.Raw(Json.Encode(this.ViewBag.Message));
                console.log("Message is: " + myJsVariable);
                console.log("Message is: " + message);
                $('#discount-message').text(myJsVariable);
                if (dis > 0) {
                    $("#totalBefore").hide();
                    $("#totalAfter").show();
                }


            }
        });

    };
</script>
@section Upload {
    <script>
        $(function () {
            function show_popup() {
                $("#message1").hide();

            };
            window.setTimeout(show_popup, 5000); // 5 seconds
        });
    </script>
}
